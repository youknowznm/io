<% include ./common/header.ejs %>

<!--  -->
<div class="article-wrap jm-article" data-article-id="<%= doc._id %>">
    <%-: doc.content %>
</div>
<div class="article-content-nav">

</div>
<!--  -->
<div class="jm-row content-footer">
    <span class="created">
        <%-: doc.created | formatDate %>
    </span>
    <!-- IDEA 用for 不用 for ..of -->
    <div class="tags">
        <% for (let i = 0; i < doc.tags.length; i++) {%>
            <% let tag = doc.tags[i] %>
            <a class="tag" href="/<%= pageTitle %>s?tag=<%= tag %>">
                <button class="jm-button _primary" data-text="<%= tag %>"></button>
            </a>
        <%}%>
    </div>

</div>
<!-- 输入评论 -->
<div class="jm-row comment-input flexed">
    <div class="jm-input"
        data-type="text"
        data-validator="^(.){2,20}$"
        data-label="<% if (userInfo.authLevel !== 0) {%>
                        Comment as <%= userInfo.currentUserNickname %>
                    <%} else {%>
                        Log in to leave comments.
                    <%}%>"
        data-max-length="200"
        data-status="<%if(userInfo.authLevel===0){%>disabled<%}%>"
        data-error-msg="Required 2~20 characters.">
    </div>
    <button class="submit-comment jm-button _primary _disabled" data-text="submit"></button>
</div>
<!-- 评论列表 -->
<div class="jm-row">
    <ul class="comments-list">
        <% let comments = doc.comments %>
        <% for (let i in comments) {%>
            <% if (i < comments.length) {%>
            <% let c = comments[i] %>
                <li class="comment">
                    <h3 class="comment-info">
                        <span class="comment-author"><%= c.author[0].nickname %></span>
                        <span class="comment-date"><%-: c.created | getDateDiff %></span>
                        <span class="badge"><%= +i + 1 %></span>
                    </h3>
                    <p class="comment-content">
                        <%= c.content %>
                    </p>
                </li>
            <%}%>
        <%}%>
    </ul>
</div>

<ul class="article-nav"></ul>

<% include ./common/footer.ejs %>