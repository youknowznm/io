<% include ./common/header.ejs %>

<div class="article-wrap jm-article">
    <%-: doc.content %>
</div>
<div class="content-footer">
    <span class="created">
        <%-: doc.created | formatDate %>
    </span>
    <!-- IDEA 用for 不用 for ..of -->
    <% for (let i = 0; i < doc.tags.length; i++) {%>
        <button class="jm-button _primary" data-text="<%= doc.tags[i] %>"></button>
    <%}%>
</div>
<div class="comments-container">
    <!-- 输入评论 -->
    <div class="jm-row flexed">
        <div class="jm-input comment-input"
            data-type="text"
            data-validator="^(.){2,20}$"
            data-label="<% if (userInfo.authLevel !== 0) {%>
                            Comment as <%= userInfo.currentUserNickname %>
                        <%} else {%>
                            Log in to leave comments.
                        <%}%>"
            data-max-length="200"
            data-status="<%if(userInfo.authLevel===0){%>disabled<%}%>"
            data-error-msg="Required 2~20 characters.">
        </div>
        <button class="submit-comment jm-button _primary _disabled" data-text="submit"></button>
    </div>
    <!-- 评论列表 -->
    <div class="jm-row">
        <ul class="comments-list">
            <% let comments = doc.comments %>
            <% for (let i in comments) {%>
                <% if (i < comments.length) {%>
                <% let c = comments[i] %>
                    <li class="comment">
                        <h3 class="comment-info">
                            <span class="comment-author"><%= c.author[0].nickname %></span>
                            <span class="comment-date"><%-: c.created | getDateDiff %></span>
                            <span class="badge"><%= +i + 1 %></span>
                        </h3>
                        <p class="comment-content">
                            <%= c.content %>
                        </p>
                    </li>
                <%}%>
            <%}%>
        </ul>
    </div>
</div>

<ul class="article-nav"></ul>

<% include ./common/footer.ejs %>